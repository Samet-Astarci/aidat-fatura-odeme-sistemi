<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aidat TanÄ±mla â€¢ Site Aidat Takip</title>
  <link rel="stylesheet" href="/assets/app.css" />
</head>
<body>
  <div class="container">
    <div id="nav"></div>
    <div class="grid">
      <div class="card">
        <div class="hd"><h2>BorÃ§ Ekleme Paneli ğŸ’¸</h2></div>
        <div class="bd">
          
<div class="two-col">
  <div>
    <h3 style="margin-top:0;">Toplu Aidat TanÄ±mla ğŸ’¸</h3>
    <div class="row">
      <div><label>DÃ¶nem (YYYY-MM)</label><input id="period" placeholder="2025-12" /></div>
      <div><label>Tutar (TL)</label><input id="amount" type="number" step="0.01" /></div>
    </div>
    <div class="row" style="margin-top:10px;">
      <div><label>AÃ§Ä±klama</label><input id="description" placeholder="AralÄ±k 2025 AidatÄ±" /></div>
    </div>
    <div class="row" style="margin-top:12px;">
      <button id="btnApply">TÃ¼m Dairelere YansÄ±t</button>
    </div>
    <div class="footer-note">SÃ¼reÃ§: dÃ¶nem+tutar â†’ sistem aktif dolu dairelere borÃ§ yazar âœ…</div>

    <hr style="border:0;border-top:1px solid var(--border); margin:16px 0;" />
    <h3 style="margin:0;">Durum Listesi (KÄ±rmÄ±zÄ±/YeÅŸil) ğŸŸ¥ğŸŸ©</h3>
    <div class="footer-note">DÃ¶nem seÃ§ip filtrele: Ã¶deyen/Ã¶demeyen listesi</div>
    <div class="row" style="margin-top:10px;">
      <div><label>Filtre DÃ¶nem</label><input id="filterPeriod" placeholder="2025-12" /></div>
      <div style="align-self:flex-end;"><button id="btnFilter" class="btn-ghost">Getir</button></div>
    </div>
  </div>

  <div>
    <h3 style="margin-top:0;">BorÃ§lar ğŸ“‹</h3>
    <table class="table" id="tbl">
      <thead><tr><th>Daire</th><th>DÃ¶nem</th><th>Tutar</th><th>Durum</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

        </div>
      </div>
    </div>
  </div>
<script type="module">
import { requireAuth, api, qs, fmtTL } from "/assets/common.js";
import { mountNav, toast } from "/assets/ui.js";
requireAuth("admin");
mountNav();

async function load(period=""){
  try{
    const q = period ? "?period="+encodeURIComponent(period) : "";
    const data = await api("/api/dues"+q);
    const tb = qs("#tbl tbody");
    tb.innerHTML = data.dues
      .sort((a,b)=> (a.apartmentNumber-b.apartmentNumber) || a.period.localeCompare(b.period))
      .map(d=>{
        const st = d.paid ? `<span class="badge ok">Ã–dendi</span>` : `<span class="badge bad">Ã–denmedi</span>`;
        return `<tr>
          <td><b>${d.apartmentNumber ?? "-"}</b></td>
          <td>${d.period}</td>
          <td>${fmtTL(d.amount)}</td>
          <td>${st}</td>
        </tr>`;
      }).join("");
  }catch(e){
    toast("BorÃ§lar alÄ±namadÄ± âŒ", e.message);
  }
}

qs("#btnApply").addEventListener("click", async ()=>{
  try{
    const period = qs("#period").value.trim();
    const amount = Number(qs("#amount").value);
    const description = qs("#description").value.trim();
    const r = await api("/api/dues/apply", {
      method:"POST",
      body: JSON.stringify({ period, amount, description })
    });
    toast("Aidat yansÄ±tÄ±ldÄ± âœ…", `OluÅŸturulan kayÄ±t: ${r.created}`);
    load(qs("#filterPeriod").value.trim() || period);
  }catch(e){
    toast("Ä°ÅŸlem baÅŸarÄ±sÄ±z âŒ", e.message);
  }
});

qs("#btnFilter").addEventListener("click", ()=> load(qs("#filterPeriod").value.trim()));

load();
</script>
</body>
</html>
